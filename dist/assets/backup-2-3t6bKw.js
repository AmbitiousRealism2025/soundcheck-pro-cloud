import{t as r}from"./index-RWZOZ_hy.js";const c=async()=>{try{const[a,e,t,o]=await Promise.all([r.rehearsals.toArray(),r.gigs.toArray(),r.rehearsalTemplates.toArray(),r.mileageLogs.toArray()]);return{version:r.verno,timestamp:Date.now(),data:{rehearsals:a,gigs:e,rehearsalTemplates:t,mileageLogs:o}}}catch(a){throw console.error("Error exporting database:",a),a}},l=async a=>{try{await r.transaction("rw",[r.rehearsals,r.gigs,r.rehearsalTemplates,r.mileageLogs],async()=>{await Promise.all([r.rehearsals.clear(),r.gigs.clear(),r.rehearsalTemplates.clear(),r.mileageLogs.clear()]),await Promise.all([r.rehearsals.bulkAdd(a.data.rehearsals),r.gigs.bulkAdd(a.data.gigs),r.rehearsalTemplates.bulkAdd(a.data.rehearsalTemplates||[]),r.mileageLogs.bulkAdd(a.data.mileageLogs||[])])}),console.log("Database imported successfully")}catch(e){throw console.error("Error importing database:",e),e}},g=async()=>{try{const a=await c(),e=`soundcheck-backup-${a.timestamp}`;return localStorage.setItem(e,JSON.stringify(a)),localStorage.setItem("soundcheck-latest-backup",e),e}catch(a){throw console.error("Error creating backup:",a),a}},p=async()=>{try{const a=localStorage.getItem("soundcheck-latest-backup");if(!a)throw new Error("No backup found");const e=localStorage.getItem(a);if(!e)throw new Error("Backup not found");const t=JSON.parse(e);await l(t)}catch(a){throw console.error("Error restoring backup:",a),a}},u=()=>{try{const a=localStorage.getItem("soundcheck-latest-backup");if(!a)return null;const e=localStorage.getItem(a);return e?JSON.parse(e).timestamp:null}catch(a){return console.error("Error getting backup timestamp:",a),null}},n=async(a="soundcheck-backup.json")=>{try{const e=await c(),t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),o=URL.createObjectURL(t),s=document.createElement("a");s.href=o,s.download=a,s.click(),URL.revokeObjectURL(o)}catch(e){throw console.error("Error downloading database:",e),e}},m=async()=>{const a=new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5);await n(`soundcheck-backup-${a}.json`)};export{g as c,m as e,u as g,l as i,p as r};
