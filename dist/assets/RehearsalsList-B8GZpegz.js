import{j as e,L as P,r as g}from"./index-CyHvHqSZ.js";import{a as S,f as R,B as Y,d as A}from"./dates-B4UPrBdS.js";import{C as z}from"./Card-B7LRffgF.js";import{B as u}from"./Button-D-SvA5Xw.js";import{I as v,M as G}from"./Modal-DAEIASgn.js";import{S as U,o as W,s as y,a as $,u as H,b as V}from"./types-pHewKoGw.js";import{t as _}from"./taskSchema-DMwGWnmA.js";function q({rehearsal:a}){const{deleteRehearsal:m,duplicateRehearsal:x}=S(),h=a.tasks.filter(l=>l.status==="closed").length,i=a.tasks.length,o=i>0?Math.round(h/i*100):0,f=async l=>{l.preventDefault(),window.confirm(`Delete "${a.eventName}"? This cannot be undone.`)&&await m(a.id)},N=async l=>{l.preventDefault(),await x(a.id)};return e.jsx(P,{to:`/rehearsals/${a.id}`,children:e.jsxs(z,{className:"group hover:scale-[1.02] transition-transform",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-lg font-semibold truncate mb-1",children:a.eventName}),e.jsxs("p",{className:"text-sm opacity-60",children:[R(a.date,"EEE, MMM d")," at ",R(a.date,"h:mm a")]}),a.location&&e.jsx("p",{className:"text-xs opacity-40 mt-1",children:a.location})]}),a.templateId&&e.jsx(Y,{variant:"info",size:"sm",children:"Template"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs mb-1",children:[e.jsx("span",{className:"opacity-60",children:"Tasks"}),e.jsxs("span",{className:"opacity-80",children:[h,"/",i," (",o,"%)"]})]}),e.jsx("div",{className:"h-2 bg-white/10 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary transition-all duration-300",style:{width:`${o}%`}})})]}),e.jsxs("div",{className:"flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx(u,{size:"sm",variant:"ghost",onClick:N,className:"flex-1",children:"Duplicate"}),e.jsx(u,{size:"sm",variant:"danger",onClick:f,className:"flex-1",children:"Delete"})]})]})})}function J({search:a,onSearchChange:m,groupBy:x,onGroupByChange:h}){const i=[{value:"none",label:"All"},{value:"date",label:"By Date"},{value:"status",label:"By Status"}];return e.jsxs("div",{className:"space-y-4",children:[e.jsx(v,{type:"search",placeholder:"Search rehearsals...",value:a,onChange:o=>m(o.target.value)}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs opacity-60 mb-2 block",children:"Group by"}),e.jsx(U,{options:i,value:x,onChange:o=>h(o)})]})]})}const E=W({eventName:y().min(1,"Event name is required").max(100,"Event name must be less than 100 characters"),date:y().regex(/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}/,"Date must be in ISO8601 format (YYYY-MM-DDTHH:mm)"),location:y().max(200,"Location must be less than 200 characters").optional(),tasks:$(_).default([]),templateId:y().optional()}),K=E;E.partial().extend({id:y()});function ne(){var k,T,M;const{rehearsals:a,loadRehearsals:m,addRehearsal:x}=S(),{activeModal:h,openModal:i,closeModal:o}=A(),[f,N]=g.useState(""),[l,B]=g.useState("date");g.useEffect(()=>{m()},[m]);const{register:b,handleSubmit:O,formState:{errors:w},reset:L}=H(K,{defaultValues:{eventName:"",date:"",location:"",tasks:[]}}),F=async s=>{const t=Date.now(),n={id:V("rehearsal"),eventName:s.eventName,date:s.date,location:s.location,tasks:[],createdAt:t,updatedAt:t};await x(n),L(),o()},D=g.useMemo(()=>a.filter(s=>s.eventName.toLowerCase().includes(f.toLowerCase())),[a,f]),C=g.useMemo(()=>{const s=[...D].sort((t,n)=>t.date.localeCompare(n.date));if(l==="none")return{All:s};if(l==="date"){const t=new Date,n=new Date(t.getFullYear(),t.getMonth(),t.getDate()),c=new Date(n.getTime()+24*60*60*1e3),j=new Date(n.getTime()+7*24*60*60*1e3),I=new Date(t.getFullYear(),t.getMonth()+1,0),p={Today:[],Tomorrow:[],"This Week":[],"This Month":[],Past:[],Future:[]};return s.forEach(d=>{const r=new Date(d.date);r<n?p.Past.push(d):r>=n&&r<c?p.Today.push(d):r>=c&&r<j?p["This Week"].push(d):r>=j&&r<=I?p["This Month"].push(d):p.Future.push(d)}),Object.fromEntries(Object.entries(p).filter(([d,r])=>r.length>0))}if(l==="status"){const t={Upcoming:[],Past:[]},n=new Date;return s.forEach(c=>{new Date(c.date)>=n?t.Upcoming.push(c):t.Past.push(c)}),Object.fromEntries(Object.entries(t).filter(([c,j])=>j.length>0))}return{All:s}},[D,l]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("header",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Rehearsals"}),e.jsx(u,{variant:"primary",onClick:()=>i("create-rehearsal"),children:"New Rehearsal"})]}),e.jsx(J,{search:f,onSearchChange:N,groupBy:l,onGroupByChange:B}),Object.keys(C).length===0?e.jsxs("div",{className:"py-12 text-center",children:[e.jsx("p",{className:"text-lg opacity-60 mb-4",children:"No rehearsals yet. Create your first one!"}),e.jsx(u,{variant:"primary",onClick:()=>i("create-rehearsal"),children:"New Rehearsal"})]}):e.jsx("div",{className:"space-y-8",children:Object.entries(C).map(([s,t])=>e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold mb-4 opacity-80",children:s}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:t.map(n=>e.jsx(q,{rehearsal:n},n.id))})]},s))}),e.jsx(G,{open:h==="create-rehearsal",onClose:o,title:"Create New Rehearsal",children:e.jsxs("form",{onSubmit:O(F),className:"space-y-4",children:[e.jsx(v,{label:"Event Name",...b("eventName"),error:(k=w.eventName)==null?void 0:k.message,placeholder:"Band Practice"}),e.jsx(v,{label:"Date & Time",type:"datetime-local",...b("date"),error:(T=w.date)==null?void 0:T.message}),e.jsx(v,{label:"Location (optional)",...b("location"),error:(M=w.location)==null?void 0:M.message,placeholder:"Studio 5"}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(u,{type:"button",variant:"ghost",onClick:o,className:"flex-1",children:"Cancel"}),e.jsx(u,{type:"submit",variant:"primary",className:"flex-1",children:"Create"})]})]})})]})}export{ne as default};
