import{b as B,r as f,j as e,L as P,k as A,g as I,t as S,m as z}from"./index-DsEjXmEw.js";import{C as G}from"./Card-cX6znXpD.js";import{f as E,B as U}from"./dates-DLBrmLeP.js";import{B as j}from"./Button-DCCwLZlP.js";import{C as V}from"./ConfirmDialog-11iSsLTs.js";import{I as b}from"./Input-C8zBtfFX.js";import{S as W,u as Y,a as _}from"./useFormValidation-B9b7cUl7.js";import{M as $}from"./Modal-BW9_-ui1.js";function q({rehearsal:t}){const{deleteRehearsal:x,duplicateRehearsal:g}=B(),[y,i]=f.useState(!1),n=t.tasks.filter(o=>o.status==="closed").length,d=t.tasks.length,N=d>0?Math.round(n/d*100):0,m=o=>{o.preventDefault(),i(!0)},w=async()=>{await x(t.id),i(!1)},v=()=>{i(!1)},C=async o=>{o.preventDefault(),await g(t.id)};return e.jsxs(P,{to:`/rehearsals/${t.id}`,"data-testid":"rehearsal-card",children:[e.jsxs(G,{className:"group hover:scale-[1.02] transition-transform",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-lg font-semibold truncate mb-1",children:t.eventName}),e.jsxs("p",{className:"text-sm opacity-60",children:[E(t.date,"EEE, MMM d")," at ",E(t.date,"h:mm a")]}),t.location&&e.jsx("p",{className:"text-xs opacity-40 mt-1",children:t.location})]}),t.templateId&&e.jsx(U,{variant:"info",size:"sm",children:"Template"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs mb-1",children:[e.jsx("span",{className:"opacity-60",children:"Tasks"}),e.jsxs("span",{className:"opacity-80",children:[n,"/",d," (",N,"%)"]})]}),e.jsx("div",{className:"h-2 bg-white/10 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary transition-all duration-300",style:{width:`${N}%`}})})]}),e.jsxs("div",{className:"flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx(j,{size:"sm",variant:"ghost",onClick:C,className:"flex-1","data-testid":"duplicate-rehearsal-button",children:"Duplicate"}),e.jsx(j,{size:"sm",variant:"danger",onClick:m,className:"flex-1","data-testid":"delete-rehearsal-button",children:"Delete"})]})]}),e.jsx(V,{open:y,title:"Delete rehearsal?",description:e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["This will permanently delete"," ",e.jsx("strong",{children:t.eventName}),"."]}),e.jsx("p",{className:"mt-1 text-warning",children:"This action cannot be undone."})]}),confirmLabel:"Delete rehearsal",confirmVariant:"danger",onConfirm:w,onCancel:v})]})}function H({search:t,onSearchChange:x,groupBy:g,onGroupByChange:y}){const i=[{value:"none",label:"All"},{value:"date",label:"By Date"},{value:"status",label:"By Status"}];return e.jsxs("div",{className:"space-y-4",children:[e.jsx(b,{type:"search",placeholder:"Search rehearsals...",value:t,onChange:n=>x(n.target.value)}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs opacity-60 mb-2 block",children:"Group by"}),e.jsx(W,{options:i,value:g,onChange:n=>y(n)})]})]})}function se(){var T,R,M;const{rehearsals:t,loadRehearsals:x,addRehearsal:g}=B(),{activeModal:y,openModal:i,closeModal:n}=A(),[d,N]=f.useState(""),[m,w]=f.useState("date");f.useEffect(()=>{x()},[x]);const{register:v,handleSubmit:C,formState:{errors:o},reset:O}=Y(z,{defaultValues:{eventName:"",date:"",location:"",tasks:[]}}),F=async s=>{const a=Date.now(),l={id:_("rehearsal"),eventName:s.eventName,date:s.date,location:s.location,tasks:[],createdAt:a,updatedAt:a};await g(l),O(),n()},D=f.useMemo(()=>t.filter(s=>s.eventName.toLowerCase().includes(d.toLowerCase())),[t,d]),k=f.useMemo(()=>{const s=[...D].sort((a,l)=>I(a.date,l.date));if(m==="none")return{All:s};if(m==="date"){const a=new Date,l=new Date(a.getFullYear(),a.getMonth(),a.getDate()).getTime(),h=l+24*60*60*1e3,u=l+7*24*60*60*1e3,L=new Date(a.getFullYear(),a.getMonth()+1,0,23,59,59,999).getTime(),p={Today:[],Tomorrow:[],"This Week":[],"This Month":[],Past:[],Future:[]};return s.forEach(c=>{const r=S(c.date);if(r===null){p.Future.push(c);return}r<l?p.Past.push(c):r>=l&&r<h?p.Today.push(c):r>=h&&r<u?p["This Week"].push(c):r>=u&&r<=L?p["This Month"].push(c):p.Future.push(c)}),Object.fromEntries(Object.entries(p).filter(([c,r])=>r.length>0))}if(m==="status"){const a={Upcoming:[],Past:[]},l=Date.now();return s.forEach(h=>{const u=S(h.date);u===null||u>=l?a.Upcoming.push(h):a.Past.push(h)}),Object.fromEntries(Object.entries(a).filter(([h,u])=>u.length>0))}return{All:s}},[D,m]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("header",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Rehearsals"}),e.jsx(j,{variant:"primary",onClick:()=>i("create-rehearsal"),"data-testid":"new-rehearsal-button",children:"New Rehearsal"})]}),e.jsx(H,{search:d,onSearchChange:N,groupBy:m,onGroupByChange:w}),Object.keys(k).length===0?e.jsxs("div",{className:"py-12 text-center",children:[e.jsx("p",{className:"text-lg opacity-60 mb-4",children:"No rehearsals yet. Create your first one!"}),e.jsx(j,{variant:"primary",onClick:()=>i("create-rehearsal"),children:"New Rehearsal"})]}):e.jsx("div",{className:"space-y-8",children:Object.entries(k).map(([s,a])=>e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold mb-4 opacity-80",children:s}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:a.map(l=>e.jsx(q,{rehearsal:l},l.id))})]},s))}),e.jsx($,{open:y==="create-rehearsal",onClose:n,title:"Create New Rehearsal",children:e.jsxs("form",{onSubmit:C(F),className:"space-y-4",children:[e.jsx(b,{label:"Event Name",...v("eventName"),error:(T=o.eventName)==null?void 0:T.message,placeholder:"Band Practice"}),e.jsx(b,{label:"Date & Time",type:"datetime-local",...v("date"),error:(R=o.date)==null?void 0:R.message}),e.jsx(b,{label:"Location (optional)",...v("location"),error:(M=o.location)==null?void 0:M.message,placeholder:"Studio 5"}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(j,{type:"button",variant:"ghost",onClick:n,className:"flex-1","data-testid":"cancel-create-rehearsal",children:"Cancel"}),e.jsx(j,{type:"submit",variant:"primary",className:"flex-1","data-testid":"submit-create-rehearsal",children:"Create"})]})]})})]})}export{se as default};
